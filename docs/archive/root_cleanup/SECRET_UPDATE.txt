PALET8 API KEY SECRET UPDATE
=============================

Date: 2025-10-31
Issue: Authentication failures due to shell escaping of exclamation mark in API key

ROOT CAUSE:
-----------
The API key "SecureApiKey2024ProfileBackend!" contains an exclamation mark (!)
When using shell commands like `echo -n`, the ! character was being escaped as \!
This caused the actual API key sent in requests to be: "SecureApiKey2024ProfileBackend\!"
The profile backend API rejected this as "Invalid API key"

SOLUTION:
---------
Created new secret version using printf instead of echo to avoid shell escaping:
  printf 'SecureApiKey2024ProfileBackend!' | gcloud secrets versions add palet8-api-key --data-file=-

NEW SECRET VERSION:
-------------------
Secret Name: palet8-api-key
Version: 5
Created: 2025-10-31
Value: SecureApiKey2024ProfileBackend!
(No escape characters, no trailing newline)

VERIFICATION:
-------------
Tested with curl:
  gcloud secrets versions access 5 --secret="palet8-api-key" > /tmp/apikey.txt
  curl -H "X-API-Key: $(cat /tmp/apikey.txt)" -H "User-Agent: Palet8-Agents/1.0" \
       https://api.palet8.biz/api/v1/credits/balance/8136454439069

Result: HTTP 200 OK with customer data âœ…

PREVIOUS VERSIONS:
------------------
Version 4: Created 2025-10-31T06:34:16 (had trailing space or newline issue)
Version 3: Created 2025-10-28T13:04:37
Version 2: Created 2025-10-28T08:35:38
Version 1: Created 2025-10-28T08:35:36

NEXT STEPS:
-----------
1. Cloud Run services using "latest" version will automatically pick up version 5
2. If services reference specific versions, they need to be updated to version 5
3. Redeploy agents API if needed to ensure new secret is loaded

ENVIRONMENT CONFIGURATION:
--------------------------
Both services use the same secret reference:
- palet8-agents: PALET8_API_KEY -> secretKeyRef: palet8-api-key:latest
- palet8-customer-app: PALET8_API_KEY -> secretKeyRef: palet8-api-key:latest

Since both reference "latest", version 5 will be used automatically.
